#!/usr/bin/python2.7
#Author Shilpesh Trivedi

import sys
import json
import requests


def malbazaarlookup(hash):


    report = open(hash+'_malbazaar_report.json','a')

    API = '' #Enter your MalwareBazzar API here

    headers = {'API-KEY': API}

    data = {'query': 'get_info', 'hash': hash}

    url = "https://mb-api.abuse.ch/api/v1/"

    response = requests.post(url, data=data)

    if response.json()["query_status"] == 'hash_not_found':

        print '\n',' \033[38;5;160m[-] The sample hash was not found on Malbazaar\033[0;0m','\n'

    else:

        response_json = response.json()["data"][0]

        print '\n','\033[38;5;120m[+] Malbazaar analysis report: \033[0;0m','\n'
        print '\033[38;5;110m'+json.dumps(response_json, indent = 3)+'\033[0;0m'

        report.write(str(json.dumps(response_json, indent = 3))+'\n')


if __name__ == '__main__':

    try:

        hash = sys.argv[1]

        malbazaarlookup(str(hash))

    except:

        print '\n',' \033[38;5;170m[*] Hash must required as a argument\033[0;0m','\n'